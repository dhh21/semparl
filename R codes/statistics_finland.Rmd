---
title: "Statistics Finland"
subtitle: "Municipal populations by year"
output: 
  html_document:
    toc: true
    toc_float: true
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r get_data}
library(dplyr)
library(tidyr)
library(pxweb)
#d <- pxweb_interactive()
```


# Data retrieval using pxweb

## 1990s Recession 

### 1980-1993

```{r data_1980_1993}
# PXWEB query 
pxweb_query_list <- 
  list("Kunta"=c("004","005","006","009","010","754","014","015","016","017","018","019","035","040","043","044","045","046","047","049","050","051","052","060","061","062","065","069","071","072","073","074","075","076","077","078","079","081","082","083","084","085","086","111","090","091","095","097","098","099","101","102","103","105","106","283","108","109","139","140","142","143","145","146","153","148","150","149","151","152","163","164","165","167","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","186","202","204","205","208","210","211","212","213","214","216","217","218","219","220","223","224","226","227","230","231","232","233","235","236","239","240","320","241","243","244","245","246","247","248","249","250","251","252","254","255","256","257","259","260","261","262","263","265","266","271","272","273","275","276","277","279","280","281","284","285","286","287","288","289","290","291","292","293","295","297","299","300","301","303","304","305","306","308","310","312","315","316","317","318","319","398","399","400","401","407","402","403","405","406","408","410","413","414","415","416","417","418","419","420","421","422","423","424","425","426","444","429","430","431","433","434","435","436","438","439","440","441","442","443","475","476","478","479","480","481","482","483","484","485","489","490","491","492","493","494","495","498","499","500","501","503","504","505","506","507","529","531","532","533","534","535","536","537","538","540","541","543","544","545","559","560","561","562","563","564","567","309","576","577","578","573","580","581","582","599","583","854","584","585","586","587","588","589","592","594","593","595","598","601","602","603","604","606","607","608","609","611","638","614","615","616","617","618","619","620","623","624","625","626","630","631","632","633","635","636","678","680","681","682","683","684","686","687","689","691","692","694","696","697","699","698","700","701","702","704","708","705","707","728","729","730","732","734","736","737","738","739","740","741","742","743","746","747","748","749","751","753","755","758","759","761","762","765","766","768","770","771","772","774","775","776","777","778","781","783","784","831","832","833","834","835","837","838","841","844","845","846","848","849","864","850","851","853","855","856","857","858","859","863","885","886","887","889","890","891","892","893","895","785","905","906","908","909","911","912","913","092","915","916","917","918","919","920","921","922","924","925","926","927","928","931","932","933","934","935","936","937","940","941","942","943","923","944","971","972","973","975","976","977","978","979","980","981","988","989","992"),
       "Tunnusluku"=c("01"),
       "Vuosi"=c("1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993"))

px_data <- pxweb_get(url = "https://pxnet2.stat.fi/PXWeb/api/v1/fi/Kuntien_talous_ja_toiminta/Kuntien%20ja%20kuntayhtymien%20raportoimat%20tiedot%201975-2014/Kunnat/ktt014/210_ktt14_1980_1993_fi.px",
                     query = pxweb_query_list)

# Convert to data.frame 
population_1980_1993 <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")

# Get pxweb data comments 
#px_data_comments <- pxweb_data_comments(px_data)
#px_data_comments_df <- as.data.frame(px_data_comments)

# Cite the data as 
pxweb_cite(px_data)

```

### 1993-1996

```{r data_1993_1996}

# PXWEB query 
pxweb_query_list <- 
  list("Kunta"=c("004","005","006","009","010","754","014","015","016","017","018","019","035","040","043","044","045","046","047","049","050","051","052","060","061","062","065","069","071","072","073","074","075","076","077","078","079","081","082","083","084","085","086","111","090","091","095","097","098","099","101","102","103","105","106","283","108","109","139","140","142","143","145","146","153","148","150","149","151","152","163","164","165","167","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","186","202","204","205","208","210","211","212","213","214","216","217","218","219","220","223","224","226","227","230","231","232","233","235","236","239","240","320","241","243","244","245","246","247","248","249","250","251","252","254","255","256","257","259","260","261","262","263","265","266","271","272","273","275","276","277","279","280","281","284","285","286","287","288","289","290","291","292","293","295","297","299","300","301","303","304","305","306","308","310","312","315","316","317","318","319","398","399","400","401","407","402","403","405","406","408","410","413","414","415","416","417","418","419","420","421","422","423","424","425","426","444","429","430","431","433","434","435","436","438","439","440","441","442","443","475","476","478","479","480","481","482","483","484","485","489","490","491","492","493","494","495","498","499","500","501","503","504","505","506","507","529","531","532","533","534","535","536","537","538","540","541","543","544","545","559","560","561","562","563","564","567","309","576","577","578","573","580","581","582","599","583","854","584","585","586","587","588","589","592","594","593","595","598","601","602","603","604","606","607","608","609","611","638","614","615","616","617","618","619","620","623","624","625","626","630","631","632","633","635","636","678","680","681","682","683","684","686","687","689","691","692","694","696","697","699","698","700","701","702","704","708","705","707","728","729","730","732","734","736","737","738","739","740","741","742","743","746","747","748","749","751","753","755","758","759","761","762","765","766","768","770","771","772","774","775","776","777","778","781","783","784","831","832","833","834","835","837","838","841","844","845","846","848","849","864","850","851","853","855","856","857","858","859","863","885","886","887","889","890","891","892","893","895","785","905","906","908","909","911","912","913","092","915","916","917","918","919","920","921","922","924","925","926","927","928","931","932","933","934","935","936","937","940","941","942","943","923","944","971","972","973","975","976","977","978","979","980","981","988","989","992"),
       "Tunnusluku"=c("1120"),
       "Vuosi"=c("1993","1994","1995","1996"))

# Download data 
px_data <- 
  pxweb_get(url = "https://pxnet2.stat.fi/PXWeb/api/v1/fi/Kuntien_talous_ja_toiminta/Kuntien%20ja%20kuntayhtymien%20raportoimat%20tiedot%201975-2014/Kunnat/ktt014/200_ktt14_1993_1996_fi.px",
            query = pxweb_query_list)

# Convert to data.frame 
population_1993_1996 <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")

# Get pxweb data comments 
#px_data_comments <- pxweb_data_comments(px_data)
#px_data_comments_df <- as.data.frame(px_data_comments)

# Cite the data as 
pxweb_cite(px_data)

```

### Merge population datasets


```{r recession_years}
population_recession <- population_1980_1993 %>%
  filter(Vuosi %in% 1986:1992) %>% # Select specified years and avoid selecting overlapping years
  bind_rows(population_1993_1996) %>%
  filter(Vuosi %in% 1986:1995) %>%
  select(-Tunnusluku) %>%
  mutate(Vuosi = as.numeric(Vuosi)) %>%
  arrange(Kunta, Vuosi)


head(population_recession)
```



## Financial Crisisa 2007-2008


### 2002-2005

```{r data_2002_2005}
# PXWEB query 
pxweb_query_list <- 
  list("Alue"=c("004","005","006","009","010","754","015","016","017","018","019","035","040","043","044","045","046","047","049","050","051","052","060","061","062","065","069","071","072","073","074","075","076","077","078","079","081","082","083","084","085","086","111","090","091","095","097","098","099","101","102","103","105","106","283","108","109","139","140","142","143","145","146","153","148","150","149","151","152","163","164","165","167","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","186","202","204","205","208","210","211","212","213","214","216","217","218","219","220","223","224","226","227","230","231","232","233","235","236","239","240","320","241","243","244","245","246","247","248","249","250","251","252","254","255","256","257","259","260","261","262","263","265","266","271","272","273","275","276","277","279","280","281","284","285","286","287","288","289","290","291","292","293","295","297","300","301","303","304","305","306","308","310","312","315","316","317","318","319","398","399","400","401","407","402","403","405","406","408","410","413","414","415","416","417","418","419","420","421","422","423","424","425","426","444","429","430","431","433","434","435","436","438","439","440","441","442","443","475","476","478","479","480","481","482","483","484","485","489","490","491","493","494","495","498","499","500","501","503","504","505","506","507","529","531","532","533","534","535","536","537","538","540","541","543","544","545","559","560","561","562","563","564","567","309","576","577","578","573","580","581","582","599","583","854","584","585","586","587","588","589","592","594","593","640","595","598","601","602","603","604","606","607","608","609","611","638","614","615","616","617","618","619","620","623","624","625","626","630","631","632","633","635","636","678","680","681","682","683","684","686","687","689","691","692","694","696","697","698","699","700","701","702","704","708","705","707","728","729","730","732","734","736","737","738","739","740","741","742","743","746","747","748","749","751","753","755","758","759","761","762","765","766","768","770","771","772","774","775","776","777","778","781","783","784","831","832","833","834","835","837","838","844","845","846","848","849","864","850","851","853","855","856","857","858","859","863","885","886","887","889","890","891","892","893","895","785","905","906","908","909","911","912","913","092","915","916","917","918","919","920","921","922","924","925","926","927","928","931","932","933","934","935","936","937","940","941","942","943","923","944","971","972","973","975","976","977","978","979","980","981","988","989","992"),
       "Tunnusluku"=c("30"),
       "Vuosi"=c("2002","2003","2004","2005"))

# Download data 
px_data <- 
  pxweb_get(url = "https://pxnet2.stat.fi/PXWeb/api/v1/fi/Kuntien_talous_ja_toiminta/Kuntien%20ja%20kuntayhtymien%20raportoimat%20tiedot%201975-2014/Kunnat/ktt014/150_ktt14_2002_2005_fi.px",
            query = pxweb_query_list)

# Convert to data.frame 
population_2002_2005 <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")

# Get pxweb data comments 
#px_data_comments <- pxweb_data_comments(px_data)
#px_data_comments_df <- as.data.frame(px_data_comments)

# Cite the data as 
pxweb_cite(px_data)
```
### 2006-2007

```{r data_2006_2007}
# PXWEB query 
pxweb_query_list <- list("Alue"=c("004","005","006","009","010","015","016","017","018","019","020","035","040","043","044","045","046","047","049","050","051","052","060","061","062","065","069","071","072","073","074","075","076","077","078","079","081","082","083","084","085","086","090","091","092","095","097","098","099","101","102","103","105","106","108","109","111","139","140","142","143","145","146","148","149","150","151","152","153","163","164","165","167","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","186","202","204","205","208","210","211","213","214","216","217","218","220","223","224","226","227","230","231","232","233","235","236","239","240","241","243","244","245","246","247","248","249","250","252","254","255","256","257","259","260","261","262","263","265","266","271","272","273","275","276","277","279","280","281","283","284","285","286","287","288","289","290","291","292","295","297","300","301","303","304","305","306","308","309","310","312","315","316","317","318","319","320","398","399","400","401","402","403","405","406","407","408","410","413","414","415","416","417","418","419","420","421","422","423","424","425","426","429","430","433","434","435","436","438","439","440","441","442","443","444","475","476","478","479","480","481","482","483","484","485","489","490","491","493","494","495","498","499","500","501","503","504","505","506","507","529","531","532","533","534","535","536","537","538","540","541","543","544","545","559","560","561","562","563","564","567","573","576","577","578","580","581","583","584","585","586","587","588","592","593","595","598","599","601","602","603","604","606","607","608","609","611","614","615","616","617","618","619","620","623","624","625","626","630","631","632","633","635","636","638","640","678","680","681","682","683","684","686","687","689","691","692","694","696","697","698","700","701","702","704","705","707","708","729","732","734","736","737","738","739","740","741","742","743","746","747","748","749","751","753","754","755","758","759","761","762","765","766","768","770","771","772","774","775","776","777","778","781","783","784","785","831","832","833","834","835","837","838","844","845","846","848","849","850","851","853","854","855","857","858","859","863","864","885","886","887","889","890","892","893","895","905","906","908","909","911","912","913","915","916","918","920","921","922","923","924","925","926","927","928","931","932","933","934","935","936","940","941","942","944","945","971","972","973","975","976","977","978","979","980","981","988","989","992"),
                         "Tunnusluku"=c("30"),
                         "Vuosi"=c("2006","2007"))

# Download data 
px_data <- pxweb_get(url = "https://pxnet2.stat.fi/PXWeb/api/v1/fi/Kuntien_talous_ja_toiminta/Kuntien%20ja%20kuntayhtymien%20raportoimat%20tiedot%201975-2014/Kunnat/ktt014/140_ktt14_2006_2007_fi.px", query = pxweb_query_list)

# Convert to data.frame 
population_2006_2007 <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")

# Get pxweb data comments 
#px_data_comments <- pxweb_data_comments(px_data)
#px_data_comments_df <- as.data.frame(px_data_comments)

# Cite the data as 
pxweb_cite(px_data)
```

### 2008

```{r data_2008}
# PXWEB query 
pxweb_query_list <- 
  list("Alue"=c("004","005","006","009","010","015","016","017","018","019","020","035","040","043","044","045","046","047","049","050","051","052","060","061","062","065","069","071","072","073","074","075","076","077","078","079","081","082","083","084","086","090","091","092","095","097","098","099","101","102","103","105","106","108","109","111","139","140","142","143","145","146","148","149","150","151","152","153","163","164","165","167","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","186","202","204","205","208","210","211","213","214","216","217","218","220","223","224","226","227","230","231","232","233","235","236","239","240","241","243","244","245","246","247","248","249","250","252","254","255","256","257","259","260","261","262","263","265","271","272","273","275","276","277","279","280","281","283","284","285","286","287","288","289","290","291","295","297","300","301","303","304","305","306","308","309","310","312","315","316","317","318","319","320","398","399","400","401","402","403","405","406","407","408","410","413","414","416","417","418","419","420","421","422","423","424","425","426","429","430","433","434","435","436","438","440","441","442","444","475","476","478","480","481","482","483","484","485","489","491","493","494","495","498","499","500","501","503","504","505","506","507","529","531","532","533","534","535","536","537","538","540","541","543","544","545","559","560","561","562","563","564","567","573","576","577","578","580","581","583","584","585","586","587","588","592","593","595","598","599","601","602","603","604","606","607","608","609","611","614","615","616","617","618","619","620","623","624","625","626","630","631","632","633","635","636","638","678","680","681","682","683","684","686","687","689","691","692","694","696","697","698","700","701","702","704","705","707","729","732","734","736","737","738","739","740","741","742","743","746","747","748","749","751","753","754","755","758","759","761","762","765","766","768","771","775","776","777","778","781","783","784","785","831","832","833","834","835","837","838","844","845","846","848","849","850","851","853","854","855","857","858","859","863","885","886","887","889","890","892","893","895","905","906","908","909","911","912","913","915","916","918","920","921","922","923","924","925","926","927","931","933","934","935","936","941","942","945","971","972","973","975","976","977","978","979","980","981","988","989","992"),
       "Tunnusluku"=c("30"),
       "Vuosi"=c("2008"))

# Download data 
px_data <- 
  pxweb_get(url = "https://pxnet2.stat.fi/PXWeb/api/v1/fi/Kuntien_talous_ja_toiminta/Kuntien%20ja%20kuntayhtymien%20raportoimat%20tiedot%201975-2014/Kunnat/ktt014/130_ktt14_2008_fi.px",
            query = pxweb_query_list)

# Convert to data.frame 
population_2008 <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text") %>% rename(`Kuntien tunnusluvut` = `Kuntien tunnusluvut 2008`)


# Get pxweb data comments 
#px_data_comments <- pxweb_data_comments(px_data)
#px_data_comments_df <- as.data.frame(px_data_comments)

# Cite the data as 
pxweb_cite(px_data)
```

### 2009

```{r data_2009}
# PXWEB query 
pxweb_query_list <- list("Alue"=c("005","009","010","015","016","018","019","020","035","043","046","047","049","050","051","052","060","061","062","065","069","071","072","074","075","076","077","078","079","081","082","084","086","090","091","092","095","097","098","099","102","103","105","106","108","109","111","139","140","142","143","145","146","148","149","151","152","153","164","165","167","169","170","171","172","174","176","177","178","179","181","182","186","202","204","205","208","211","213","214","216","217","218","223","224","226","227","230","231","232","233","235","236","239","240","241","244","245","246","248","249","250","254","255","256","257","260","261","263","265","271","272","273","275","276","280","283","284","285","286","287","288","289","290","291","295","297","300","301","304","305","309","310","312","316","317","318","319","320","322","398","399","400","402","403","405","407","408","410","413","416","417","418","420","421","422","423","424","425","426","430","433","434","435","436","438","440","441","442","444","445","475","476","478","480","481","483","484","489","491","494","495","498","499","500","503","504","505","507","508","529","531","532","534","535","536","537","538","540","541","543","545","559","560","561","562","563","564","567","576","577","578","580","581","583","584","585","588","592","593","595","598","599","601","604","607","608","609","611","614","615","616","618","619","620","623","624","625","626","630","631","635","636","638","678","680","681","683","684","686","687","689","691","694","696","697","698","700","701","702","704","707","710","729","732","734","736","738","739","740","742","743","746","747","748","749","751","753","755","758","759","761","762","765","766","768","771","775","777","778","781","783","785","790","791","831","832","833","834","837","838","844","845","846","848","849","850","851","853","854","857","858","859","863","886","887","889","890","892","893","895","905","908","911","915","916","918","921","922","924","925","926","927","931","934","935","936","941","942","945","972","976","977","978","980","981","989","992"),
                         "Tunnusluku"=c("30"),
                         "Vuosi"=c("2009"))

# Download data 
px_data <- pxweb_get(url = "https://pxnet2.stat.fi/PXWeb/api/v1/fi/Kuntien_talous_ja_toiminta/Kuntien%20ja%20kuntayhtymien%20raportoimat%20tiedot%201975-2014/Kunnat/ktt014/120_ktt14_2009_fi.px",
                     query = pxweb_query_list)

# Convert to data.frame 
population_2009 <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text") %>% rename(`Kuntien tunnusluvut` = `Kuntien tunnusluvut 2009`)

# Get pxweb data comments 
#px_data_comments <- pxweb_data_comments(px_data)
#px_data_comments_df <- as.data.frame(px_data_comments)

# Cite the data as 
pxweb_cite(px_data)

```
### 2010

```{r data_2010}
# PXWEB query 
pxweb_query_list <- list("Alue"=c("005","009","010","015","016","018","019","020","035","043","046","047","049","050","051","052","060","061","062","065","069","071","072","074","075","076","077","078","079","081","082","084","086","090","091","092","097","098","099","102","103","105","106","108","109","111","139","140","142","143","145","146","148","149","151","152","153","164","165","167","169","170","171","172","174","176","177","178","179","181","182","186","202","204","205","208","211","213","214","216","217","218","223","224","226","227","230","231","232","233","235","236","239","240","241","244","245","246","248","249","250","254","255","256","257","260","261","263","265","271","272","273","275","276","280","283","284","285","286","287","288","289","290","291","295","297","300","301","304","305","309","310","312","316","317","318","319","320","322","398","399","400","402","403","405","407","408","410","413","416","417","418","420","421","422","423","425","426","430","433","434","435","436","438","440","441","442","444","445","475","476","478","480","481","483","484","489","491","494","495","498","499","500","503","504","505","507","508","529","531","532","534","535","536","538","540","541","543","545","559","560","561","562","563","564","567","576","577","578","580","581","583","584","588","592","593","595","598","599","601","604","607","608","609","611","614","615","616","618","619","620","623","624","625","626","630","631","635","636","638","678","680","681","683","684","686","687","689","691","694","696","697","698","700","702","704","707","710","729","732","734","736","738","739","740","742","743","746","747","748","749","751","753","755","758","759","761","762","765","766","768","771","775","777","778","781","783","785","790","791","831","832","833","834","837","838","844","845","846","848","849","850","851","853","854","857","858","859","863","886","887","889","890","892","893","895","905","908","911","915","916","918","921","922","924","925","926","927","931","934","935","936","941","942","945","972","976","977","980","981","989","992"),
       "Tunnusluku"=c("30"),
       "Vuosi"=c("2010"))

# Download data 
px_data <- pxweb_get(url = "https://pxnet2.stat.fi/PXWeb/api/v1/fi/Kuntien_talous_ja_toiminta/Kuntien%20ja%20kuntayhtymien%20raportoimat%20tiedot%201975-2014/Kunnat/ktt014/110_ktt14_2010_fi.px",
            query = pxweb_query_list)

# Convert to data.frame 
population_2010 <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")  %>% rename(`Kuntien tunnusluvut` = `Kuntien tunnusluvut 2010`)


# Get pxweb data comments 
#px_data_comments <- pxweb_data_comments(px_data)
#px_data_comments_df <- as.data.frame(px_data_comments)

# Cite the data as 
pxweb_cite(px_data)

```

### 2011

```{r data_2011}
# PXWEB query 
pxweb_query_list <- list("Alue"=c("005","009","010","016","018","019","020","035","043","046","047","049","050","051","052","060","061","062","065","069","071","072","074","075","076","077","078","079","081","082","084","086","090","091","092","097","098","099","102","103","105","106","108","109","111","139","140","142","143","145","146","148","149","151","152","153","164","165","167","169","170","171","172","174","176","177","178","179","181","182","186","202","204","205","208","211","213","214","216","217","218","223","224","226","230","231","232","233","235","236","239","240","241","244","245","246","248","249","250","254","255","256","257","260","261","263","265","271","272","273","275","276","280","283","284","285","286","287","288","290","291","295","297","300","301","304","305","309","312","316","317","318","319","320","322","398","399","400","402","403","405","407","408","410","413","416","417","418","420","421","422","423","425","426","430","433","434","435","436","438","440","441","442","444","445","475","476","478","480","481","483","484","489","491","494","495","498","499","500","503","504","505","507","508","529","531","532","534","535","536","538","540","541","543","545","560","561","562","563","564","567","576","577","578","580","581","583","584","588","592","593","595","598","599","601","604","607","608","609","611","614","615","616","618","619","620","623","624","625","626","630","631","635","636","638","678","680","681","683","684","686","687","689","691","694","696","697","698","700","702","704","707","710","729","732","734","736","738","739","740","742","743","746","747","748","749","751","753","755","758","759","761","762","765","766","768","771","775","777","778","781","783","785","790","791","831","832","833","834","837","838","844","845","846","848","849","850","851","853","854","857","858","859","863","886","887","889","890","892","893","895","905","908","911","915","918","921","922","924","925","926","927","931","934","935","936","941","942","946","972","976","977","980","981","989","992"),
       "Tunnusluku"=c("30"),
       "Vuosi"=c("2011"))

# Download data 
px_data <- pxweb_get(url = "https://pxnet2.stat.fi/PXWeb/api/v1/fi/Kuntien_talous_ja_toiminta/Kuntien%20ja%20kuntayhtymien%20raportoimat%20tiedot%201975-2014/Kunnat/ktt014/100_ktt14_2011_fi.px",
            query = pxweb_query_list)


population_2011 <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")  %>% rename(`Kuntien tunnusluvut` = `Kuntien tunnusluvut 2011`)


# Get pxweb data comments 
#px_data_comments <- pxweb_data_comments(px_data)
#px_data_comments_df <- as.data.frame(px_data_comments)

# Cite the data as 
pxweb_cite(px_data)
```


### 2012

```{r data_2012}
# PXWEB query 
pxweb_query_list <- list("Alue"=c("005","009","010","016","018","019","020","035","043","046","047","049","050","051","052","060","061","062","065","069","071","072","074","075","076","077","078","079","081","082","084","086","090","091","092","097","098","099","102","103","105","106","108","109","111","139","140","142","143","145","146","148","149","151","152","153","164","165","167","169","170","171","172","174","176","177","178","179","181","182","186","202","204","205","208","211","213","214","216","217","218","223","224","226","230","231","232","233","235","236","239","240","241","244","245","246","248","249","250","254","255","256","257","260","261","263","265","271","272","273","275","276","280","283","284","285","286","287","288","290","291","295","297","300","301","304","305","309","312","316","317","318","319","320","322","398","399","400","402","403","405","407","408","410","413","416","417","418","420","421","422","423","425","426","430","433","434","435","436","438","440","441","442","444","445","475","476","478","480","481","483","484","489","491","494","495","498","499","500","503","504","505","507","508","529","531","532","534","535","536","538","540","541","543","545","560","561","562","563","564","567","576","577","578","580","581","583","584","588","592","593","595","598","599","601","604","607","608","609","611","614","615","616","618","619","620","623","624","625","626","630","631","635","636","638","678","680","681","683","684","686","687","689","691","694","696","697","698","700","702","704","707","710","729","732","734","736","738","739","740","742","743","746","747","748","749","751","753","755","758","759","761","762","765","766","768","771","775","777","778","781","783","785","790","791","831","832","833","834","837","838","844","845","846","848","849","850","851","853","854","857","858","859","863","886","887","889","890","892","893","895","905","908","911","915","918","921","922","924","925","926","927","931","934","935","936","941","942","946","972","976","977","980","981","989","992"),
       "Tunnusluku"=c("30"),
       "Vuosi"=c("Arvo"))

# Download data 
px_data <- pxweb_get(url = "https://pxnet2.stat.fi/PXWeb/api/v1/fi/Kuntien_talous_ja_toiminta/Kuntien%20ja%20kuntayhtymien%20raportoimat%20tiedot%201975-2014/Kunnat/ktt014/090_ktt14_2012_fi.px",
            query = pxweb_query_list)


population_2012 <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")  %>% rename(`Kuntien tunnusluvut` = `Kuntien tunnusluvut 2012`)


# Get pxweb data comments 
#px_data_comments <- pxweb_data_comments(px_data)
#px_data_comments_df <- as.data.frame(px_data_comments)

# Cite the data as 
pxweb_cite(px_data)
```


## 2013
```{r data_2013}
# PXWEB query 
pxweb_query_list <- 
  list("Alue"=c("005","009","010","016","018","019","020","035","043","046","047","049","050","051","052","060","061","062","065","069","071","072","074","075","076","077","078","079","081","082","086","090","091","092","097","098","099","102","103","105","106","108","109","111","139","140","142","143","145","146","148","149","151","152","153","164","165","167","169","170","171","172","174","176","177","178","179","181","182","186","202","204","205","208","211","213","214","216","217","218","224","226","230","231","232","233","235","236","239","240","241","244","245","249","250","256","257","260","261","263","265","271","272","273","275","276","280","283","284","285","286","287","288","290","291","295","297","300","301","304","305","309","312","316","317","318","319","320","322","398","399","400","402","403","405","407","408","410","413","416","417","418","420","421","422","423","425","426","430","433","434","435","436","438","440","441","442","444","445","475","476","478","480","481","483","484","489","491","494","495","498","499","500","503","504","505","507","508","529","531","532","535","536","538","541","543","545","560","561","562","563","564","576","577","578","580","581","583","584","588","592","593","595","598","599","601","604","607","608","609","611","614","615","616","619","620","623","624","625","626","630","631","635","636","638","678","680","681","683","684","686","687","689","691","694","697","698","700","702","704","707","710","729","732","734","736","738","739","740","742","743","746","747","748","749","751","753","755","758","759","761","762","765","766","768","771","777","778","781","783","785","790","791","831","832","833","834","837","838","844","845","846","848","849","850","851","853","854","857","858","859","886","887","889","890","892","893","895","905","908","911","915","918","921","922","924","925","927","931","934","935","936","941","946","976","977","980","981","989","992"),
       "Tunnusluku"=c("30"),
       "Vuosi"=c("Arvo"))

# Download data 
px_data <- pxweb_get(url = "https://pxnet2.stat.fi/PXWeb/api/v1/fi/Kuntien_talous_ja_toiminta/Kuntien%20ja%20kuntayhtymien%20raportoimat%20tiedot%201975-2014/Kunnat/ktt014/080_ktt14_2013_fi.px",
            query = pxweb_query_list)

population_2013 <- as.data.frame(px_data, column.name.type = "text", variable.value.type = "text")  %>% rename(`Kuntien tunnusluvut` = `Kuntien tunnusluvut 2013`)


# Get pxweb data comments 
#px_data_comments <- pxweb_data_comments(px_data)
#px_data_comments_df <- as.data.frame(px_data_comments)

# Cite the data as 
pxweb_cite(px_data)
```



### Merge population datasets


```{r financial_crisis}
population_financial_crisis <- population_2002_2005 %>%
  bind_rows(population_2006_2007) %>%
  bind_rows(population_2008) %>%
  bind_rows(population_2009) %>%
  bind_rows(population_2010) %>%
  bind_rows(population_2011) %>%
  bind_rows(population_2012) %>%
  bind_rows(population_2013) %>%
  mutate(Kunta = stringr::str_remove(Alue, "\\d+\\s+"),
         Vuosi = as.numeric(Vuosi)) %>%
  mutate(Kunta = ifelse(Kunta == "Kristiinankaup.", "Kristiinankaupunki", Kunta)) %>%
  select(-Tunnusluku, -Alue) %>%
  filter(Vuosi %in% 2004:2013) %>% # Select specified years and avoid selecting overlapping years
  arrange(Kunta, Vuosi)


head(population_financial_crisis)
```

## Merge datasets

```{r merge_data}
municipal_population <- population_recession %>%
  bind_rows(population_financial_crisis) %>%
  arrange(Kunta, Vuosi) %>% 
  complete(Kunta, Vuosi, fill = list(`Kuntien tunnusluvut` = 0)) # Add missing rows for indentified missing populations
```


### Export as csv


```{r export}
write.csv(municipal_population, "statfi_population.csv", row.names = FALSE)
```


